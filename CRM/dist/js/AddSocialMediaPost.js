(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["AddSocialMediaPost"],{6086:function(e,t,a){"use strict";a.r(t),a.d(t,"uploader",(function(){return w}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{staticClass:"container-fluid mt-3 tab-style plaintabs"},[e._m(0),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 p-0 mt-2 float-left"},[a("div",{staticClass:"col-sm-12 col-md-6 p-0 float-left"},[a("Form",{ref:"AddPost"},[a("dynamic-form",{ref:"AddPostForm",attrs:{lang:"en",buttons:e.buttons,schema:e.FormSchema},scopedSlots:e._u([{key:"tgslot-Content",fn:function(t){var i=t.data;return[a("ckeditor",{attrs:{editor:e.editor},on:{ready:e.onReady},model:{value:i.fieldInfo.value,callback:function(t){e.$set(i.fieldInfo,"value",t)},expression:"data.fieldInfo.value"}}),e._v(" "),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:"Content"}},[e._v(e._s(i.error))])]}}])}),e.isShowAdditionalBtns?a("div",{staticClass:"col-12 float-left mt-3"},[a("div",{staticClass:"float-left border",staticStyle:{"max-width":"450px","min-width":"450px"}},[a("a",{staticClass:"float-left d-flex p-2 borderbottom w-100",attrs:{href:"javascript:;"},on:{click:function(t){return e.saveForm("PostNow")}}},[a("div",{staticClass:"float-left d-block"},[a("em",{staticClass:"fa fa-paper-plane text-info p-3 font-24"})]),a("div",{staticClass:"float-left mt-2 ml-2"},[a("span",{staticClass:"w-100 float-left font-weight-medium"},[e._v("Post Now")]),a("span",{staticClass:"w-100 float-left font-12 font-weight-medium"},[e._v("Send out this post to the selected social channels/accounts.")])])]),a("a",{staticClass:"float-left d-flex p-2 borderbottom w-100",attrs:{href:"javascript:;"},on:{click:function(t){return e.SchedulePost("SchedulePost")}}},[a("div",{staticClass:"float-left d-block"},[a("em",{staticClass:"fa fa-clock-o p-3 font-24",staticStyle:{color:"#1dbdac"}})]),a("div",{staticClass:"float-left mt-2 ml-2"},[a("span",{staticClass:"w-100 float-left font-weight-medium"},[e._v("Schedule Post")]),a("span",{staticClass:"w-100 float-left font-12 font-weight-medium"},[e._v("Schedule a post for a later date or time.")])])]),a("a",{staticClass:"float-left d-flex p-2 borderbottom w-100",attrs:{href:"javascript:;"},on:{click:function(t){return e.SchedulePost("SendForApproval")}}},[a("div",{staticClass:"float-left d-block"},[a("em",{staticClass:"fa fa-check-circle text-success p-3 font-24"})]),a("div",{staticClass:"float-left mt-2 ml-2"},[a("span",{staticClass:"w-100 float-left font-weight-medium"},[e._v("Send Post For Approval")]),a("span",{staticClass:"w-100 float-left font-12 font-weight-medium"},[e._v("Send for approval first with in your agency or organisation.")])])]),a("a",{staticClass:"float-left d-flex p-2 w-100",attrs:{href:"javascript:;"}},[a("div",{staticClass:"float-left d-block"},[a("em",{staticClass:"fa fa-trash text-danger p-3 font-24"})]),a("div",{staticClass:"float-left mt-2 ml-2"},[a("span",{staticClass:"w-100 float-left font-weight-medium"},[e._v("Delete")]),a("span",{staticClass:"w-100 float-left font-12 font-weight-medium"},[e._v("Delete this post forever.")])])])])]):e._e()],1)],1),a("div",{staticClass:"col-sm-12 col-md-6 p-0 float-left bg-light p-4"},[a("div",{staticClass:"col-12 bg-white p-2"},[a("div",{staticClass:"col-12 bg-light p-2"},[e._v("Preview in")]),a("div",{staticClass:"col-12 bg-light p-2 mt-2"},[a("span",{domProps:{innerHTML:e._s(e.FormSchema[1].Data[0].value)}}),e._l(e.fileData,(function(e){return a("img",{attrs:{src:"data:image/gif;base64,"+e.base64String}})}))],2)])])])]),e.isShowScheduleApproveModal?a("modalScheduleAndApprovePost",{attrs:{reqFrom:e.reqFrom},on:{close:function(t){e.isShowScheduleApproveModal=!1}}}):e._e()],1)])},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col-md-12 p-0 mt-2"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[e._v("New Social Post")]),a("span",{staticClass:"p-actions float-right"},[a("a",{staticClass:"p-action-btn text-white",attrs:{href:"javascript:;",value:"cal",id:"ShowCalender",title:"","data-toggle-tooltip":"tooltip","data-original-title":"Back to List"}},[a("i",{staticClass:"fa fa-angle-double-left pr-2"}),a("br"),a("span",[e._v(" Back to List")])])])])])}],o=a("53ca"),l=a("c7eb"),s=a("1da1"),r=(a("4de4"),a("d3b7"),a("e9c4"),a("159b"),a("b0c0"),a("313d"),a("0eb6"),a("b7ef"),a("8bd4"),a("9769")),c=a("d4ec"),d=a("bee2"),u=function(){function e(t){Object(c["a"])(this,e),this.loader=t}return Object(d["a"])(e,[{key:"upload",value:function(){var e=this;return new Promise((function(t,a){var i=new window.FileReader;i.addEventListener("load",(function(){t({default:i.result})})),i.addEventListener("error",(function(e){a(e)})),i.addEventListener("abort",(function(){a()})),e.loader.file.then((function(e){i.readAsDataURL(e)}))}))}},{key:"abort",value:function(){}}]),e}(),f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("div",{staticClass:"modal my-popups  fade show",staticStyle:{display:"block"},attrs:{role:"dialog"}},[a("div",{staticClass:"modal-dialog mw-1100",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header mheader-user"},[a("button",{staticClass:"close",attrs:{type:"button"},on:{click:function(t){return e.$emit("close")}}},[a("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})]),a("h4",{staticClass:"modal-title",attrs:{id:"myModalLabel"}},[e._v(e._s(e.$t(e.reqFrom)))])]),a("div",{staticClass:"modal-body"},[e.isLoaded?a("dynamic-form",{attrs:{lang:"en",buttons:e.buttons,schema:e.FormSchema},on:{OnSubmit:e.onSubmit}}):e._e(),a("div",{staticClass:"col-lg-6"},[a("div",{staticClass:"py-2"},[a("span",{staticClass:"mandatory"},[e._v(" "+e._s(e.$t("MandatoryString"))+" ")])])])],1)])])])])},p=[],m={props:{reqFrom:{type:String,required:!0}},data:function(){return{isLoaded:!1,FormSchema:[{layoutType:"double",Data:[{astype:"DateField",label:"Start Date (M/D/YYYY)",name:"StartDate",value:"",placeholder:"",config:{format:"M/D/YYYY",minDate:new Date},validationRules:{required:!0},visibility:!0},{astype:"DateField",label:this.$t("StartTime"),name:"StartTime",value:"",placeholder:"",config:{mode:"Time",minDate:new Date},validationRules:{required:!0},visibility:!0},{astype:"SelectField",label:this.$t("Approver"),name:"Approver",value:"",placeholder:"",config:{options:[]},validationRules:{required:!0},visibility:!1},{astype:"TextField",label:this.$t("AddNote"),name:"AddNote",value:"",placeholder:"",validationRules:{required:!1},visibility:!1}]}],buttons:[{type:"submit",class:"btn btn-success",text:"SchedulePost"==this.reqFrom?"Schedule Post":'<i class="fa fa-clock-o pr-2"></i>Schedule & Send For Approval'},{type:"button",class:"btn btn-danger",text:"<i class='fa fa-close pr-2'></i>Cancel",onClick:this.Close}]}},created:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e,"SendForApproval"!=a.reqFrom){t.next=6;break}return a.FormSchema[0].Data[2].visibility=!0,a.FormSchema[0].Data[3].visibility=!0,t.next=6,a.GetCampaignApprovers();case 6:a.isLoaded=!0;case 7:case"end":return t.stop()}}),t)})))()},methods:{onSubmit:function(e,t){var a=this;a.$parent.scheduleDate=e.StartDate,a.$parent.scheduleTime=e.StartTime,a.$parent.approverId=e.Approver,a.$parent.approverNote=e.AddNote,a.$parent.saveForm(a.reqFrom),a.$emit("close")},Close:function(){var e=this;e.$emit("close")},GetCampaignApprovers:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i="id=&moduleName=CRM&type=CRM_USERS",t.next=4,r["a"].getDDLData(i+"&search=").then((function(e){if(""!=e.data){var t=e.data.DATA,i=[];null!=t&&(t.forEach((function(e){i.push({name:e.name,value:e.value})})),a.FormSchema[0].Data[2].config.options=t)}}));case 4:case"end":return t.stop()}}),t)})))()}}},h=m,v=a("2877"),b=Object(v["a"])(h,f,p,!1,null,null,null),g=b.exports,C={components:{modalScheduleAndApprovePost:g},data:function(){return{editor:this.CLASSIC_EDITOR,AllPages:[],content:"<p>Some initial content</p>",editorConfig:{extraPlugins:[w]},File:null,fileData:[],base64String:null,isShowAdditionalBtns:!1,isShowScheduleApproveModal:!1,reqFrom:"",scheduleDate:null,scheduleTime:null,approverId:0,approverNote:"",FormSchema:[{layoutType:"double",Data:[{astype:"SelectField",label:this.$t("PostTo"),name:"PostTo",value:"",placeholder:this.$t("Select"),config:{options:[]},validationRules:{required:!0}},{astype:"SelectField",label:this.$t("AssignCampaignOwner"),name:"AssignCampaignOwner",value:"",placeholder:this.$t("Select"),config:{options:[]},validationRules:{required:!1}}]},{layoutType:"single",Data:[{astype:"SlotField",label:this.$t("Content"),name:"Content",value:"",placeholder:"",validationRules:{required:!0}},{astype:"FileField",showLabel:!0,label:this.$t("Upload Imgae/Video"),name:"Attachment",value:"",placeholder:"",validationRules:"",FieldIndex:0,config:{maxSize:1,accept:[{fileType:"doc",iconClass:"fa-file-word-o"},{fileType:"docx",iconClass:"fa-file-word-o"},{fileType:"txt",iconClass:"fa-file-text-o"},{fileType:"jpg",iconClass:"fa-file-image-o"},{fileType:"jpeg",iconClass:"fa-file-image-o"},{fileType:"png",iconClass:"fa-file-image-o"},{fileType:"gif",iconClass:"fa-file-image-o"},{fileType:"bmp",iconClass:"fa-file-image-o"},{fileType:"mp4",iconClass:"fa-file-video-o"},{fileType:"mov",iconClass:"fa-file-video-o"}],onChange:this.GetBase64String,showAddIcon:!1,onAddButtonClick:"",multiple:!1}},{astype:"TextAreaField",label:this.$t("FollowUpComment"),name:"FollowUpComment",value:"",placeholder:"",validationRules:{required:!1}},{astype:"SelectField",label:this.$t("Category"),name:"Category",value:"",placeholder:"Select",config:{options:[],showAddIcon:!0},validationRules:{required:!1}},{astype:"SelectField",label:this.$t("Tags"),name:"Tags",value:"",placeholder:"Select",config:{options:[]},validationRules:{required:!1}}]}],buttons:[{type:"submit",class:"btn btn-success save",text:"<i class='fa fa-save pr-2'></i>Save for Later",value:"Draft",onClick:this.saveForm},{type:"button",class:"btn btn-primary",text:"Post<i class='fa fa-angle-double-right pl-2 pr-2'></i>",onClick:this.hideShowBtns}]}},created:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,t.next=3,a.GetPageList();case 3:return t.next=5,a.GetCampaignOwners();case 5:return t.next=7,a.GetTags();case 7:return t.next=9,a.GetCategories();case 9:a.FormSchema[1].Data[0].value=a.content,a.$refs.AddPostForm.UpdateKeyValue();case 11:case"end":return t.stop()}}),t)})))()},methods:{onReady:function(e){e.ui.getEditableElement().parentElement.insertBefore(e.ui.view.toolbar.element,e.ui.getEditableElement());var t=document.querySelector(".ck-file-dialog-button");t.remove();var a=document.getElementsByClassName("ck-dropdown")[2];a.remove()},saveForm:function(e){var t=this;"object"==Object(o["a"])(e)&&(e=e.value);var a=!1;"Draft"==e&&(a=!0),t.$refs.AddPost.validate().then(function(){var e=Object(s["a"])(Object(l["a"])().mark((function e(i){var n,o,s,c;return Object(l["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=17;break}if(n="",o=t.$refs.AddPostForm.ConvertDynamicFormObjToCustomFieldObj(t.FormSchema),s={ref_page_id:o.filter((function(e){return"PostTo"==e.field_name}))[0].field_value,campaign_owner_id:o.filter((function(e){return"AssignCampaignOwner"==e.field_name}))[0].field_value,attacthment:o.filter((function(e){return"Attachment"==e.field_name}))[0].field_value,content:o.filter((function(e){return"Content"==e.field_name}))[0].field_value,followup_content:o.filter((function(e){return"FollowUpComment"==e.field_name}))[0].field_value,category_id:o.filter((function(e){return"Category"==e.field_name}))[0].field_value,tag_id:o.filter((function(e){return"Tags"==e.field_name}))[0].field_value,is_draft:a,schedule_date:t.scheduleDate?t.$options.filters.formatDate(t.scheduleDate):t.scheduleDate,schedule_time:t.scheduleTime?t.$options.filters.formatTime(t.scheduleTime):t.scheduleTime,approver_id:t.approverId,approver_note:t.approverNote,files:t.fileData},n=JSON.stringify(s),c=t.AllPages.filter((function(e){return e.PAGE_ID==s.ref_page_id}))[0].ACCOUNT_NAME,!c||a){e.next=13;break}if("facebook"!=c.toLowerCase()){e.next=12;break}return e.next=10,r["a"].UploadFacebookPost(n).then((function(e){}));case 10:e.next=13;break;case 12:c.toLowerCase();case 13:return t.scheduleDate=null,t.scheduleTime=null,e.next=17,t.SaveSocialMediaPost(n);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},onSubmit:function(e,t){var a={pageId:e.PostTo,content:e.Content,follow_up_comments:e.FollowUpComment,category:e.Category,tags:e.Tags},i=JSON.stringify(a);r["a"].UploadFacebookPost(i).then((function(e){}))},uploadAdapterPlugin:function(e){var t=this;e.plugins.get("FileRepository").createUploadAdapter=function(e){return e.file.then((function(e){t.File=e}))}},GetPageList:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e,i="TYPE=CRM_SOCIAL&MODULE_NAME=CRM",r["a"].GetTriggerFieldValue(i).then((function(e){a.AllPages=e.data,null!=a.AllPages&&void 0!=a.AllPages&&(a.FormSchema[0].Data[0].config.options=[],a.AllPages.forEach((function(e){a.FormSchema[0].Data[0].config.options.push({name:e.NAME,value:e.PAGE_ID})})))}));case 3:case"end":return t.stop()}}),t)})))()},GetCampaignOwners:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i="id=&moduleName=CRM&type=CRM_USERS",t.next=4,r["a"].getDDLData(i+"&search=").then((function(e){if(""!=e.data){var t=e.data.DATA,i=[];null!=t&&(a.FormSchema[0].Data[1].config.options=[],t.forEach((function(e){i.push({name:e.name,value:e.value})})),a.FormSchema[0].Data[1].config.options=i)}}));case 4:case"end":return t.stop()}}),t)})))()},GetTags:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i="id=&moduleName=CRM&type=CRM_TAGS",t.next=4,r["a"].getDDLData(i+"&search=").then((function(e){if(""!=e.data){var t=e.data.DATA,i=[];null!=t&&(a.FormSchema[1].Data[4].config.options=[],t.forEach((function(e){i.push({name:e.name,value:e.value})})),a.FormSchema[1].Data[4].config.options=i)}}));case 4:case"end":return t.stop()}}),t)})))()},GetCategories:function(){var e=this;return Object(s["a"])(Object(l["a"])().mark((function t(){var a,i;return Object(l["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e,i="id=&moduleName=CRM&type=CRM_CAMPAIGN_CATEGORY",t.next=4,r["a"].getDDLData(i+"&search=").then((function(e){if(""!=e.data){var t=e.data.DATA,i=[];null!=t&&(a.FormSchema[1].Data[3].config.options=[],t.forEach((function(e){i.push({name:e.name,value:e.value})})),a.FormSchema[1].Data[3].config.options=i)}}));case 4:case"end":return t.stop()}}),t)})))()},GetBase64String:function(e){try{var t=this;t.fileData=[];for(var a=e.target.files,i=0;i<a.length;i++){var n=a[i],o=new FileReader;o.onload=function(e){return function(e){var a=e.target.result,i=window.btoa(a);t.base64String=i;var o=n.name;t.fileName=o;var l=o.lastIndexOf("."),s=o.substring(l+1,o.length);t.fileExt+="."+s;var r='{"ContentType":"'+n.type+'","Size":"'+n.size+'","Extension":"'+s+'"}',c=n.size;t.fileSize=c;var d={attachement_mime:r,fileName:o,base64String:i,fileSize:n.size,contentType:n.type};t.fileData.push(d)}}(),o.readAsBinaryString(n)}}catch(l){}},hideShowBtns:function(){var e=this;e.isShowAdditionalBtns=!e.isShowAdditionalBtns},SaveSocialMediaPost:function(e){var t=this;return Object(s["a"])(Object(l["a"])().mark((function a(){return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t,a.next=3,r["a"].SaveSocialPost(e).then((function(e){}));case 3:case"end":return a.stop()}}),a)})))()},SchedulePost:function(e){var t=this;t.reqFrom=e,t.isShowScheduleApproveModal=!0}}},w=function(e){e.plugins.get("FileRepository").createUploadAdapter=function(e){return new u(e)}},S=C,y=Object(v["a"])(S,i,n,!1,null,null,null);t["default"]=y.exports}}]);
//# sourceMappingURL=AddSocialMediaPost.js.map