(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMImportAccounts"],{"47f6":function(t,a,e){"use strict";e.r(a);var l=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("loader",{attrs:{"is-visible":t.isLoading}}),e("section",{staticClass:"main-content",attrs:{id:"main-content"}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 padding-t_8"},[e("div",{staticClass:"theme-primary partition-full"},[e("span",{staticClass:"p-name text-white"},[t._v(t._s(t.$t("Import"))+" "+t._s(t.$t("Accounts")))]),e("span",{staticClass:"p-actions float-right"},[e("a",{staticClass:"p-action-btn text-white float-right",attrs:{href:"javascript:;",id:"btnbacktolist",title:t.$t("BacktoList")},on:{click:t.BackToList}},[e("em",{staticClass:"fa fa-angle-double-left pr-2"}),e("br"),t._v(t._s(t.$t("BacktoList")))])])])])]),e("div",{staticClass:"border p-3"},[e("form",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"form-group"},[e("label",[t._v(t._s(t.$t("Download"))+" "+t._s(t.$t("SampleFile"))+":")]),e("div",{staticClass:"d-flex align-items-center"},[e("p",[e("a",{staticClass:"text-dark",attrs:{href:"/Content/files/ImportAccountsSampleFile.xlsx",checkprivilege:"no",download:""}},[e("img",{staticClass:"mr-2",attrs:{src:"/Content/images/assets/excel-icon.png",alt:""}}),t._v(t._s(t.$t("Accounts"))+" "),e("em",{staticClass:"fa fa-download ml-2 text-dark"})])])])])]),e("div",{staticClass:"col-xl-4 col-lg-4 col-md-6"},[e("div",{staticClass:"form-group"},[e("label",[t._v(t._s(t.$t("UploadFile"))+":"),e("span",{staticClass:"text-danger"},[t._v("*")])]),e("div",{staticClass:"custom-file"},[e("input",{staticClass:"downloadexcel",attrs:{type:"file",id:"flUserFile",size:"19",name:"flUserFile",tabindex:"1"},on:{change:function(a){return t.setFile(a)}}})])])]),e("div",{staticClass:"col-xl-5 col-lg-6 col-md-12 mt-lg-4 pl-lg-0 p-2"},[e("a",{staticClass:"btn btn-success mr-2",attrs:{href:"javascript:void(0);",id:"uploadfile",title:t.$t("ImportFromExcelFile")},on:{click:t.UploadContactFile}},[e("em",{staticClass:"fa fa-sign-in pr-2",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.$t("ImportFromExcelFile")))]),e("a",{staticClass:"btn btn-danger",attrs:{href:"/CRM/ImportAccounts",id:"",title:t.$t("Reset")}},[e("em",{staticClass:"fa fa-refresh mr-2 "}),t._v(t._s(t.$t("Reset")))])]),t._m(0)])])])]),e("div",{staticClass:"col-lg-12 p-0 float-left"},[e("div",{staticClass:"listing mt-2"},[e("div",{staticClass:"table-responsive"},[e("table",{staticClass:"table table-bordered dt-responsive nowrap mt-0",staticStyle:{width:"100%"},attrs:{id:"tblBulkContact","aria-describedby":"importaccount"}},[t._m(1),e("tbody",[e("tr",[e("td",{staticClass:"text-center text-danger norecord no-record",attrs:{colspan:"2"}},[t._v(t._s(t.$t("NoRecordfound")))])]),e("tr",{staticClass:"d-none",attrs:{id:"trdata",crtrwid:"1001"}},[e("td",[e("select",{staticClass:"form-control d-none",attrs:{name:"TableColumns"}},[e("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select"))+" "+t._s(t.$t("Column")))])]),e("select",{staticClass:"form-control",attrs:{id:"ddlTableColumn",name:"TableColumn"}})]),e("td",[e("select",{staticClass:"form-control",attrs:{name:"ExcelColumns"}},[e("option",{attrs:{value:""}},[t._v(t._s(t.$t("Select"))+" "+t._s(t.$t("Column")))])]),e("select",{staticClass:"form-control",attrs:{id:"ddlExcelColumn",name:"ExcelColumn"}})])])])])]),e("div",{staticClass:"clearfix"}),e("div",{staticClass:"col-lg-12 text-right mt-3"},[e("input",{attrs:{type:"hidden",id:"hdnBatchId",value:"Batch_id"}}),e("a",{staticClass:"btn btn-success my-2 d-none",attrs:{href:"javascript:void(0);",id:"savebtn",title:t.$t("Save")},on:{click:t.SaveContactFile}},[e("em",{staticClass:"fa fa-save pr-2"}),e("span",[t._v(t._s(t.$t("Save")))])])])])])],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-lg-12"},[e("div",{staticClass:"py-2"},[e("span",{staticClass:"text-danger"},[e("small",[t._v("Fields marked with an asterisk (*) are mandatory.")])])])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("thead",{staticClass:"thead-bg"},[e("tr",[e("th",[e("span",{staticClass:"d-inline-block",staticStyle:{"min-width":"138px"}},[t._v("Table Column"),e("span",{staticClass:"d-inline-block"},[e("span",{staticClass:"text-danger"},[t._v("*")])])])]),e("th",[e("span",{staticClass:"d-inline-block",staticStyle:{"min-width":"138px"}},[t._v("Excel Column"),e("span",{staticClass:"d-inline-block"},[e("span",{staticClass:"text-danger"},[t._v("*")])])])])])])}],n=(e("b0c0"),e("99af"),e("ac1f"),e("5319"),e("7db0"),e("d3b7"),e("498a"),e("e9c4"),e("9769")),i={data:function(){return{isLoading:!1,file:null,filepath:null,excelFileName:null,reqfrom:null}},created:function(){this.reqfrom=this.$route.params.reqfrom},methods:{BackToList:function(){this.$router.push({name:"CRMAccounts"})},setFile:function(t){this.file=t.target.files[0],this.excelFileName=t.target.files[0].name},UploadContactFile:function(){this.isLoading=!0;var t=this,a=new FormData;a.append("file",t.file),n["a"].ImportContactsPost(a).then((function(a){var e=a.data;0==e.Status?(t.filepath=e.Msg,setTimeout((function(){t.loadExcelHeader(e.Msg)}),1e3),setTimeout((function(){t.loadTableHeader()}),2e3),t.isLoading=!1):(t.isLoading=!1,t.ShowAlert(e.Msg,"warning",!0,t.$t("Alert")))}))},loadExcelHeader:function(t){var a=this;a.isLoading=!0;var e="filepath=".concat(t,"&excelFileName=").concat(a.excelFileName);n["a"].GetContactExcelColumn(e).then((function(t){var e=t.data;if(a.isLoading=!1,void 0!=e.length){var l=$("#ddlExcelColumn");l.empty(),$.each(e,(function(t,a){$("#hdnBatchId").val(a.batch_id),$("#ddlExcelColumn").append("<option value='"+a.column_Name+"'Data_Type='"+a.data_Type+"' >"+a.column_Name+"</option>")}))}}))},loadTableHeader:function(){var t=this;t.isLoading=!0;var a="submodule=CRM_ACCOUNTS&batchid=".concat($("#hdnBatchId").val());n["a"].GetContactTableColumn(a).then((function(a){var e=a.data;if(t.isLoading=!1,void 0!=e.length){var l=$("#ddlTableColumn");l.empty(),$.each(e,(function(t,a){$("#ddlTableColumn").append("<option value='"+a.column_Name+"'Data_Type='"+a.data_Type+"'Is_Required='"+a.is_Required+"'Picklist_Options='"+a.picklist_Options+"'Custom_Field_Id='"+a.custom_Field_Id+"' >"+a.column_Name.replace(/_/g," ")+"</option>")})),t.createMultiRows(e.length)}}))},createMultiRows:function(t){try{var a=this;$("uploadfile").addClass("disabled"),$("#savebtn").removeClass("d-none");var e=1002;a.isLoading=!0;var l=$("table#tblBulkContact tr#trdata"),s="",n="";$(".norecord").addClass("d-none");for(var i=0;i<t;i++){if($(l).clone().attr({crtrwid:e}).removeClass("d-none").addClass("visible").find("input,a,select,div").each((function(){$(this).attr({id:function(t,a){return a+""+e},name:function(t,a){return a+""+e},value:function(t,a){return a}}),$(this).removeClass("d-none")})).end().appendTo("table#tblBulkContact"),s=$("#ddlExcelColumn").children("option").clone(),n=$("#ddlTableColumn").children("option").clone(),$("table#tblBulkContact tr.visible td select[id='ddlTableColumn"+e+"']").remove(),$("table#tblBulkContact tr.visible td select[name='TableColumns"+e+"']").attr("id","ddlTableColumn"+e),$("table#tblBulkContact tr.visible td select[name='TableColumns"+e+"']").attr("onclick","CheckDuplicateTableRecord(ddlTableColumn"+e+")"),$("table#tblBulkContact tr.visible td select[name='TableColumns"+e+"']").append(n),$("table#tblBulkContact tr.visible td select[id='ddlExcelColumn"+e+"']").remove(),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+e+"']").attr("id","ddlExcelColumn"+e),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+e+"']").attr("onclick","CheckDuplicateExcelRecord(ddlExcelColumn"+e+")"),$("table#tblBulkContact tr.visible td select[name='ExcelColumns"+e+"']").append(s),s.length>i){var d=$("#ddlTableColumn"+e+" option[value='"+s[i].value+"']").attr("data_type"),o=$("#ddlExcelColumn"+e+" option[value='"+s[i].value+"']").attr("data_type"),c=$("#ddlTableColumn"+e+" option[value='"+s[i].value+"']").attr("value"),r=$("#ddlExcelColumn"+e+" option[value='"+s[i].value+"']").attr("value");void 0!=d&&void 0!=o&&c.toLowerCase()==r.toLowerCase()&&($("#ddlTableColumn"+e+" option[value='"+s[i].value+"']").attr("selected","selected"),$("#ddlExcelColumn"+e+" option[value='"+s[i].value+"']").attr("selected","selected"))}e++}$("table#tblBulkContact tr.visible[crtrwid ='1001']").removeClass("visible").addClass("d-none"),a.isLoading=!1}catch(u){this.isLoading=!1}},CheckDuplicateTableRecord:function(t){var a,e,l,s=[],n=!0;$("table#tblBulkContact tr#trdata").each((function(){var t=$(this).find("td").eq(0).find("select option:selected").text();s.push(t)}));var i,d,o=1002;for(n=!1,i=1;i<s.length;i++){for(a="#ddlTableColumn"+o,d=i+1;d<s.length;d++)if(s[i]==s[d]&&"Select Column"!=s[i]){n=!0,l=a,e="#ddlTableColumn"+(d-1+1002);break}if(n)break;$(a).removeClass("border border-danger"),$(savebtn).removeClass("disabled"),o++}n&&($(l).addClass("border border-danger"),$(e).addClass("border border-danger"),$(savebtn).addClass("disabled")),n=!1,$("table#tblBulkContact tr#trdata").each((function(){$(this).find("td").eq(1).find("select").hasClass("border-danger")&&$(savebtn).addClass("disabled")}))},CheckDuplicateExcelRecord:function(t){var a,e,l,s=[],n=!0;$("table#tblBulkContact tr#trdata").each((function(){var t=$(this).find("td").eq(1).find("select option:selected").text();s.push(t)}));var i,d,o=1002;n=!1;for(i=1;i<s.length;i++){for(a="#ddlExcelColumn"+o,d=i+1;d<s.length;d++)if(s[i]==s[d]&&"Select Column"!=s[i]){n=!0,l=a,e="#ddlExcelColumn"+(d-1+1002);break}if(n)break;$(a).removeClass("border border-danger"),$(savebtn).removeClass("disabled"),o++}n&&($(l).addClass("border border-danger"),$(e).addClass("border border-danger"),$(savebtn).addClass("disabled")),n=!1,$("table#tblBulkContact tr#trdata").each((function(){$(this).find("td").eq(0).find("select").hasClass("border-danger")&&$(savebtn).addClass("disabled")}))},SaveContactFile:function(){var t=this,a="<contactentries>\n",e=!1,l=0,s=!1;if($("table#tblBulkContact tr.visible").each((function(){if(l=$(this).attr("crtrwid"),$("table#tblBulkContact tr.visible[crtrwid ='"+l+"']").removeClass("alert-warning"),!$(this).hasClass("alert-success"))if(""==$("#ddlTableColumn"+l).val()?($("#ddlTableColumn"+l).addClass("is-invalid"),e=!0):$("#ddlTableColumn"+l).removeClass("is-invalid"),""==$("#ddlExcelColumn"+l).val()?($("#ddlExcelColumn"+l).addClass("is-invalid"),e=!0):$("#ddlExcelColumn"+l).removeClass("is-invalid"),e)$("#lblError").parent().removeClass("d-none"),$("#lblError").html(t.$t("PleaseCorrectHighlightedErrors")),$(document).scrollTop(0);else{$("#lblError").html(""),$("#lblError").parent().addClass("d-none"),l=$(this).attr("crtrwid");var n=$(this).find("#ddlTableColumn"+l).val(),i=$(this).find("#ddlTableColumn"+l).val(),d=$(this).find("#ddlTableColumn"+l).find(":selected").attr("data_type"),o=$(this).find("#ddlTableColumn"+l).find(":selected").attr("Custom_Field_Id"),c=$(this).find("#ddlTableColumn"+l).find(":selected").attr("Picklist_Options"),r=$(this).find("#ddlExcelColumn"+l).val(),u=$("#ddlExcelColumn"+l).find(":selected").attr("data_type");null==c&&(c=""),void 0!=i&&(s=!0,a+="\n<contact>\n\t<batch_id>"+$("#hdnBatchId").val()+"</batch_id>\n\t<row_id>"+l+"</row_id>\n\t<original_column_name>"+n+"_"+c+"</original_column_name>\n\t<column_name>"+i+"</column_name>\n\t<data_type>"+d.toLowerCase()+"</data_type>\n\t<custom_field_id>"+o+"</custom_field_id>\n\t<excel_column_name>"+r.trim().replace(/[\r\n ]+/gm,"_").replace(/[^a-zA-Z0-9_ \s]/gi,"").replace(/[-\s]/g,"_")+"</excel_column_name>\n\t<excel_data_type>"+u.toLowerCase()+"</excel_data_type>\n</contact>\n")}})),a+="\n</contactentries>\n",!e&&s){console.log({xmltrackentries:a,batch_id:$("#hdnBatchId").val()});var i={xmltrackentries:a,batch_id:$("#hdnBatchId").val(),callingSource:"Account"},d=JSON.stringify(i);n["a"].BulkUploadContact(d).then((function(a){t.isLoading=!1;var e=a.data;void 0!=e.length&&t.$router.push({name:"CRMContactImportDetails",params:{subModuleCode:"CRM_ACCOUNTS",reqfrom:"ImportAccounts",batchid:i.batch_id}})}))}}}},d=i,o=e("2877"),c=Object(o["a"])(d,l,s,!1,null,null,null);a["default"]=c.exports}}]);
//# sourceMappingURL=CRMImportAccounts.js.map