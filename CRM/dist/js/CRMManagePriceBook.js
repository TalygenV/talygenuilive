(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["CRMManagePriceBook"],{"34b0":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"main-content"},[a("loader",{attrs:{"is-visible":e.isLoading}}),a("div",{attrs:{id:"divMainLeadData"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12 padding-t_8"},[a("div",{staticClass:"theme-primary partition-full"},[a("span",{staticClass:"p-name text-white"},[e._v(e._s(e.$t("ManagePriceBook")))])])])]),a("div",{staticClass:"border p-3"},[a("Form",{ref:"form"},[a("dynamic-form",{ref:"PriceBookForm",attrs:{lang:"en",buttons:e.buttons,schema:e.FormSchema},on:{OnSubmit:e.onSubmit},scopedSlots:e._u([{key:"tgslot-PriceBookTable",fn:function(t){t.data;return[e.isPriceInfo?a("div",{staticClass:"listing p-3"},[a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table table-bordered dt-responsive nowrap mt-0",staticStyle:{width:"100%","min-width":"650px!important"},attrs:{id:"priceBookTable","aria-describedby":"pricebooktable"}},[a("thead",{staticClass:"thead-bg"},[a("tr",{staticClass:"text-capitalize"},[a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("RangeFrom")))])]),a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("RangeTo")))])]),a("th",{attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("Discount"))+" "+e._s(2==e.discountType?"(%)":"(Flat)"))])]),a("th",{staticClass:"text-center",attrs:{scope:"col"}},[a("span",[e._v(e._s(e.$t("Action")))])])])]),a("tbody",e._l(e.priceInformation,(function(t,n){return a("tr",{key:n},[a("td",[a("Field",{attrs:{name:"rangeFrom"+n,rules:{required:!0,numeric:!0,min_value:n>0?parseInt(e.priceInformation[n-1].rangeTo)+1:1},label:"Range From"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rangeFrom,expression:"item.rangeFrom"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeFrom"+n,id:"rangeFrom"+n},domProps:{value:t.rangeFrom},on:{input:[function(a){a.target.composing||e.$set(t,"rangeFrom",a.target.value)},function(a){return e.changevalue(t)}]}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.rangeFrom}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"rangeTo"+n,rules:{required:!0,numeric:!0,min_value:parseInt(""==t.rangeFrom?0:t.rangeFrom)+1},label:"Range To"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.rangeTo,expression:"item.rangeTo"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"rangeTo"+n,id:"rangeTo"+n},domProps:{value:t.rangeTo},on:{input:function(a){a.target.composing||e.$set(t,"rangeTo",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.rangeTo}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",[a("Field",{attrs:{name:"discount"+n,rules:{required:!0,numeric:!0,max_value:100},label:"Discount"},scopedSlots:e._u([{key:"default",fn:function(i){var o=i.errors,r=i.touched,s=i.invalid;return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.discount,expression:"item.discount"}],class:{"form-control":!0,"is-invalid":r&&s},attrs:{type:"text",name:"discount"+n,id:"discount"+n},domProps:{value:t.discount},on:{keyup:function(a){return e.discountFix(n,t.discount)},input:function(a){a.target.composing||e.$set(t,"discount",a.target.value)}}}),a("span",{staticClass:"invalid-feedback d-block",attrs:{name:e.discount}},[e._v(e._s(o[0]))])]}}],null,!0)})],1),a("td",{staticClass:"text-center single-action"},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.deletePriceDetailRow(n)}}},[a("em",{staticClass:"fa fa-trash action-icon text-danger"})])])])})),0)]),a("div",{staticClass:"col-lg-12 add-form-field text-right py-3"},[a("a",{staticClass:"btn btn-success",attrs:{href:"javascript:;"},on:{click:function(t){return e.addNewForPriceDetails()}}},[a("em",{staticClass:"fa fa-plus pr-2",attrs:{"aria-hidden":"true"}}),e._v(e._s(e.$t("AddMore")))])])])]):e._e()]}}])}),a("div",{staticClass:"col-lg-6"},[a("div",{staticClass:"py-2"},[a("small",[a("span",{staticClass:"text-danger"},[e._v(" "+e._s(e.$t("MandatoryString")))])])])])],1)],1)])],1)},i=[],o=a("c7eb"),r=a("1da1"),s=(a("d3b7"),a("159b"),a("b0c0"),a("a434"),a("ac1f"),a("1276"),a("b680"),a("e9c4"),a("9769")),c={data:function(){return{isLoading:!1,pricebookid:this.$route.params.id,userId:null,compnayId:null,dateformat:null,isPriceInfo:!1,discountType:0,onEditPriceInfo:!1,priceInformation:[],FormSchema:[],buttons:[{type:"submit",class:"btn btn-success save",text:"<i class='fa fa-save pr-2'></i>Submit"},{type:"button",class:"btn btn-danger",text:"<i class='fa fa-close pr-2'></i>Cancel",onClick:this.onCancel}]}},created:function(){this.userId=this.GetUserInfo.ID,this.companyId=this.GetUserInfo.CompanyId,this.dateformat=this.GetUserInfo.DateFormat,this.FetchData()},methods:{onCancel:function(){this.$router.push({name:"CRMPriceBook"})},FetchData:function(){var e=this;e.isLoading=!0;var t="recordId=".concat(e.$route.params.id,"&moduleName=CRM&subModuleCode=CRM_PRICE_BOOKS&langCode=en");s["a"].GetDynamicForm(t).then((function(t){e.isLoading=!1,e.FormSchema=e.$refs.PriceBookForm.ConvertCustomFieldIntoDynamicFormObj(t.data.data),e.FormSchema.forEach((function(t,a){t.Data.forEach(function(){var t=Object(r["a"])(Object(o["a"])().mark((function t(a,n){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:"price_book_owner"==a.name&&(a.config.onSearchChange=e.onSearch),a.config.onChange=e.onChangeEventForFields;case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())})),e.FormSchema.push({layoutType:"single",Data:[{astype:"SlotField",name:"PriceBookTable",value:"",visibility:!1}]}),e.pricebookid>0&&""!=t.data.otherData&&void 0!==t.data.otherData&&(e.isPriceInfo=!0,e.FormSchema[1].Data[0].visibility=!0,e.priceInformation=t.data.otherData)}))},onSearch:function(e,t,a){var n=this;n.searchSelectData(a,n,t)},searchSelectData:function(e,t,a){this.ShowSearchData(e,t,a)},ShowSearchData:function(){var e=Object(r["a"])(Object(o["a"])().mark((function e(t,a,n){var i,r;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=this,r="id=&&moduleName=CRM&type=CRM_USERS&search=".concat(t,"&refId="),"undefined"==typeof n&&(n=0),n.config.options=[],e.next=6,s["a"].getDDLData(r).then((function(e){e.data&&(i.JsonObj=e.data,null!=i.JsonObj&&(e.data.DATA.forEach((function(e){var t={value:e.value,name:e.name};n.config.options.push(t)})),i.$refs.PriceBookForm.UpdateKeyValue()))}));case 6:case"end":return e.stop()}}),e,this)})));function t(t,a,n){return e.apply(this,arguments)}return t}(),onChangeEventForFields:function(e,t,a){var n=this;"price_book_model"==t.name&&(n.FormSchema[1].Data[0].visibility=!0,""!=t.value&&void 0!==t.value&&"0"!=t.value?(n.onEditPriceInfo?n.onEditPriceInfo=!1:(n.priceInformation=[],n.priceDetails()),n.isPriceInfo=!0,n.discountType=null==t.value||""==t.value?0:t.value):(n.priceInformation=[],n.isPriceInfo=!1))},priceDetails:function(){var e={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(e)},addNewForPriceDetails:function(){if(""!=this.priceInformation[this.priceInformation.length-1].rangeFrom&&""!=this.priceInformation[this.priceInformation.length-1].rangeTo){var e={rangeFrom:"",rangeTo:"",discount:""};this.priceInformation.push(e)}else this.ShowAlert(this.$t("lastOneRowRequired"),"warning",!0,this.$t("Alert"))},deletePriceDetailRow:function(e){var t=this;if(1==t.priceInformation.length)return this.ShowAlert(this.$t("Atleastonerowismandatorytosave"),"warning",!0,this.$t("Alert")),!1;t.confirmR(this.$t("AssetGroup_ConfirmDelete"),!0,this.$t("Delete",["Price Details"]),(function(){t.priceInformation.splice(e,1),t.priceInformation.length<=0&&t.addNewForPriceDetails()}))},changevalue:function(e){parseInt(e.rangeFrom)>=parseInt(e.rangeTo)&&(e.rangeTo="")},discountFix:function(e,t){var a=this;if(t.indexOf(".")>=0){var n=t.split(".");n.length>1&&""!=n[1]&&(n[1].length>1?a.priceInformation[e].discount=parseFloat(t).toFixed(2):a.priceInformation[e].discount=parseFloat(t).toFixed(1))}},onSubmit:function(e,t){var a=this;a.$refs.form.validate().then((function(e){if(e){a.isLoading=!0;var t=a.$refs.PriceBookForm.ConvertDynamicFormObjToCustomFieldObj(a.FormSchema);t.forEach((function(e){"created_by"==e.field_name&&(e.field_value=a.userId),"modified_by"==e.field_name&&(e.field_value=a.userId),"company_id"==e.field_name&&(e.field_value=a.companyId),"price_book_id"==e.field_name&&(e.field_value=a.pricebookid),"price_book_owner"==e.field_name&&(a.isBlank(e.field_value)||(e.field_value=e.field_value.value))}));var n={data:t,priceInformation:a.priceInformation},i=JSON.stringify(n);s["a"].PostPriceBook(i).then((function(e){a.isLoading=!1,"1"==e.data[0].Code?(a.pricebookid>0?a.ShowAlert(a.$t("UpdatedSuccess",[a.$t("PriceBook")]),"success",!0,a.$t("Alert")):a.ShowAlert(a.$t("AddedSuccess",[a.$t("PriceBook")]),"success",!0,a.$t("Alert")),a.$router.push({name:"CRMPriceBook"})):a.ShowAlert(a.$t("AddedError",[a.$t("PriceBook")]),"failure",!0,a.$t("Alert"))}))}}))}}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,null,null);t["default"]=u.exports}}]);
//# sourceMappingURL=CRMManagePriceBook.js.map